{% extends "base.html" %}
{% load staticfiles %}
{% block title %}{{meet.meet_name}}{% endblock %}

{% block body %}
  {% if user.is_authenticated %}
  <div class="meet_detail_body">
    <div class="meet_detail_title_container">
        <h1>{{ meet.meet_name}}</h1>
    </div>
    <div class="meet_detail_info_container">
      <div class="meet_detail_description_container">
          <p id="location">{{meet.location}}</p>
          <p>{{meet.description}}</p>
      </div>
      <div class="meet_detail_time_container">
        <div class="meet_detail_date_container">
            <p>{{ meet.date|date:'Y-m-d' }} </p>
        </div>
        <div class="meet_detail_hour_container">
            <p>{{ meet.time}}</p>
        </div>
      </div>
      <div class="meet_detail_interested_container">
          <p>Skal på treffet: {{meet.users_joining.count}}</p>
      </div>
      <div class="meet_detail_join_container">
        <a href="" id="join_button" data-id="{{ meet.pk }}">Jeg vil være med!</a>
      </div>
      <a href="https://www.facebook.com/sharer/sharer.php?u=shadygarage.pythonanywhere.com/{{request.get_full_path}}">
        <input type="image" src="{% static 'images/facebooklogo.png'%}" class="facebookShare" id="facebookShareMeet"/>
      </a>
    </div>
    <div class="meet_detail_map_container">
      <div id="map"></div>
    </div>
    <div class="meet-detail-button-container">
      {% if request.user == meet.user_fk %}
        <a href="{% url 'meets:delete_meet' slug=meet.slug%}" class="btn btn-danger">Slett</a>
        <a href="{% url 'meets:update_meet' slug=meet.slug%}" class="btn btn-info">Oppdater</a>
      {% endif %}
    </div>
    <div class="meet-commentcontainer">
      <h4><a href="{% url 'meets:comment_meet' slug=meet.slug %}">Kommenter</a><h4>

      {% for comment in meet.meet_comment.all %}
        <div class="commentcontainer-comment">
          <div class="commentcontainer-userinfo">
            <div class="commentcontainer-userinfo-profilepiccontainer">
              <img class="commentcontainer-userinfo-profilepic" src="{{comment.user.profile.profile_pic.url}}" alt="bilde">
            </div>
            <div class="commentcontainer-userinfo-textinfo">
              <p>Bruker:<a href="{%url 'accounts:profile_page_pk' pk=comment.user.pk %}">{{comment.user}}</a></p>
              <p>Dato: {{comment.created|timesince}}
            </div>
          </div>
          <div class="commentcontainer-commentfield">
            <p>{{comment.comment}}</p>
            {% if request.user == comment.user %}
              <a href="{% url 'meets:meet_comment_delete' slug=meet.slug pk=comment.id %}" class="btn btn-danger btn-sm">Slett</a>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  </div>


  {% else %}
  <div class="container" >
      <div class="jumbotron">
        <h1 class="display-4">Ops, ser ut som du ikke er logget inn!</h1>
        <p class="lead">Logg inn eller registrer deg for å se treff i nærheten av deg!</p>
        <a class="btn btn-danger btn-lg" href="{% url 'accounts:login'%}" role="button">Logg inn</a>
        <a class="btn btn-info btn-lg" href="{%url 'accounts:signup'%}" role="button">Registrer meg!</a>
      </div>
      <div id ="gif" align="center">
      <iframe src="https://giphy.com/embed/rUwbpQKelwneM" width="480" height="270" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/day-perfect-burnout-rUwbpQKelwneM"></a>
      </div>
  </div>
  {% endif %}


{% endblock %}
{% block script%}
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBD4qn1fg9fSciI9hwIT8mK65aUmBHbZUg&callback=initMap">
  </script>

  <script>
    $(document).ready(function(){
      $(document.body).on("click", "#join_button", function(e){
        e.preventDefault()
        this_ = $(this)
        var meetId = this_.attr("data-id")
        var joinUrl = '../../../api/meets/' + meetId + '/join/'
        $.ajax({
          method: 'GET',
          url: joinUrl,
          success:function(data){
            console.log("FUnker")
            if(data.joining){
              this_.text("Skal")
            }else{
              this_.text("Skal ikke")
            }
          }, error:function(data){
            console.log("Error i join meet!")
          }
        })
      })
    });
  </script>
{% endblock %}
